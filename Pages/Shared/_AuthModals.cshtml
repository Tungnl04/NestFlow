<!-- Login Modal -->
<div class="modal fade" id="loginModal" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header border-0">
                <h5 class="modal-title" id="loginModalLabel">Đăng nhập</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="loginForm">
                    <div class="mb-3">
                        <label for="loginEmail" class="form-label">Email</label>
                        <input type="email" class="form-control" id="loginEmail" required>
                    </div>
                    <div class="mb-3">
                        <label for="loginPassword" class="form-label">Mật khẩu</label>
                        <input type="password" class="form-control" id="loginPassword" required>
                    </div>
                    <div class="mb-3 text-end">
                        <a href="#" class="text-decoration-none small switch-to-forgot-password">
                            Quên mật khẩu?
                        </a>
                    </div>
                    <div class="alert alert-danger d-none" id="loginError"></div>
                    <button type="submit" class="btn btn-primary w-100">Đăng nhập</button>
                </form>
                <div class="text-center mt-3">
                    <p class="mb-0">Chưa có tài khoản? <a href="#" class="switch-to-register">Đăng ký ngay</a></p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Register Modal -->
<div class="modal fade" id="registerModal" tabindex="-1" aria-labelledby="registerModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header border-0">
                <h5 class="modal-title" id="registerModalLabel">Đăng ký</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="registerForm">
                    <div class="mb-3">
                        <label for="registerFullName" class="form-label">Họ và tên</label>
                        <input type="text" class="form-control" id="registerFullName" required>
                    </div>
                    <div class="mb-3">
                        <label for="registerEmail" class="form-label">Email</label>
                        <input type="email" class="form-control" id="registerEmail" required>
                    </div>
                    <div class="mb-3">
                        <label for="registerPhone" class="form-label">Số điện thoại</label>
                        <input type="tel" class="form-control" id="registerPhone">
                    </div>
                    <div class="mb-3">
                        <label for="registerPassword" class="form-label">Mật khẩu</label>
                        <input type="password" class="form-control" id="registerPassword" required minlength="6">
                        <small class="text-muted">Mật khẩu phải có ít nhất 6 ký tự</small>
                    </div>
                    <div class="mb-3">
                        <label for="registerConfirmPassword" class="form-label">Xác nhận mật khẩu</label>
                        <input type="password" class="form-control" id="registerConfirmPassword" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Bạn là:</label>
                        <div class="d-flex gap-3">
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="userType" id="userTypeTenant" value="renter" checked>
                                <label class="form-check-label" for="userTypeTenant">
                                    Người thuê
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="userType" id="userTypeLandlord" value="landlord">
                                <label class="form-check-label" for="userTypeLandlord">
                                    Chủ trọ
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="alert alert-danger d-none" id="registerError"></div>
                    <button type="submit" class="btn btn-primary w-100">Đăng ký</button>
                </form>
                <div class="text-center mt-3">
                    <p class="mb-0">Đã có tài khoản? <a href="#" class="switch-to-login">Đăng nhập</a></p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Forgot Password Modal -->
<div class="modal fade" id="forgotPasswordModal" tabindex="-1" aria-labelledby="forgotPasswordModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header border-0">
                <h5 class="modal-title" id="forgotPasswordModalLabel">Quên mật khẩu</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Step 1: Enter Email -->
                <div id="forgotPasswordStep1">
                    <p class="text-muted">Nhập email của bạn để nhận mã xác thực</p>
                    <form id="forgotPasswordForm">
                        <div class="mb-3">
                            <label for="forgotEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="forgotEmail" required>
                        </div>
                        <div class="alert alert-danger d-none" id="forgotPasswordError"></div>
                        <button type="submit" class="btn btn-primary w-100">Gửi mã xác thực</button>
                    </form>
                </div>

                <!-- Step 2: Verify Code and Reset Password -->
                <div id="forgotPasswordStep2" class="d-none">
                    <p class="text-muted">Nhập mã xác thực đã được gửi đến email của bạn</p>
                    <form id="resetPasswordForm">
                        <div class="mb-3">
                            <label for="verificationCode" class="form-label">Mã xác thực</label>
                            <input type="text" class="form-control" id="verificationCode" required maxlength="6">
                            <small class="text-muted">Mã có hiệu lực trong 15 phút</small>
                        </div>
                        <div class="mb-3">
                            <label for="resetNewPassword" class="form-label">Mật khẩu mới</label>
                            <input type="password" class="form-control" id="resetNewPassword" required minlength="6">
                        </div>
                        <div class="mb-3">
                            <label for="resetConfirmPassword" class="form-label">Xác nhận mật khẩu mới</label>
                            <input type="password" class="form-control" id="resetConfirmPassword" required>
                        </div>
                        <div class="alert alert-danger d-none" id="resetPasswordError"></div>
                        <button type="submit" class="btn btn-primary w-100">Đặt lại mật khẩu</button>
                        <button type="button" class="btn btn-link w-100" onclick="window.NestFlowAuth.resendVerificationCode()">
                            Gửi lại mã
                        </button>
                    </form>
                </div>

                <div class="text-center mt-3">
                    <a href="#" class="switch-to-login-from-forgot">
                        Quay lại đăng nhập
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Handle modal switching when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
        // Switch from Login to Register
        document.querySelectorAll('.switch-to-register').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                if (window.NestFlowAuth && window.NestFlowAuth.switchModal) {
                    window.NestFlowAuth.switchModal('loginModal', 'registerModal');
                }
            });
        });

        // Switch from Register to Login
        document.querySelectorAll('.switch-to-login').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                if (window.NestFlowAuth && window.NestFlowAuth.switchModal) {
                    window.NestFlowAuth.switchModal('registerModal', 'loginModal');
                }
            });
        });

        // Switch from Login to Forgot Password
        document.querySelectorAll('.switch-to-forgot-password').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                if (window.NestFlowAuth && window.NestFlowAuth.switchModal) {
                    window.NestFlowAuth.switchModal('loginModal', 'forgotPasswordModal');
                }
            });
        });

        // Switch from Forgot Password to Login
        document.querySelectorAll('.switch-to-login-from-forgot').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                if (window.NestFlowAuth && window.NestFlowAuth.switchModal) {
                    window.NestFlowAuth.switchModal('forgotPasswordModal', 'loginModal');
                }
            });
        });
    });
</script>
